// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "rhel-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String          @id @default(cuid())
  email         String          @unique
  password      String
  name          String?
  planId        String?
  plan          Plan?           @relation(fields: [planId], references: [id], onDelete: SetNull)
  createdAt     DateTime        @default(now())
  searchHistory SearchHistory[]
}

model SearchHistory {
  id          String   @id @default(cuid())
  userId      String
  parameters  Json
  resultCount Int
  createdAt   DateTime @default(now())
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  leads       Lead[]
}

model Lead {
  id                        String        @id @default(cuid())
  searchHistoryId           String
  firstName                 String?
  lastName                  String?
  email                     String?
  personalEmail             String?
  fullName                  String?
  jobTitle                  String?
  linkedin                  String?
  companyName               String?
  companyWebsite            String?
  industry                  String?
  companySize               String?
  headline                  String?
  seniorityLevel            String?
  functionalLevel           String?
  city                      String?
  state                     String?
  country                   String?
  companyLinkedin           String?
  companyLinkedinUid        String?
  companyFoundedYear        String?
  companyDomain             String?
  companyPhone              String?
  companyStreetAddress      String?
  companyFullAddress        String?
  companyState              String?
  companyCity               String?
  companyCountry            String?
  companyPostalCode         String?
  keywords                  String?
  companyDescription        String?
  companyAnnualRevenue      String?
  companyAnnualRevenueClean String?
  companyTotalFunding       String?
  companyTotalFundingClean  String?
  companyTechnologies       String?
  searchHistory             SearchHistory @relation(fields: [searchHistoryId], references: [id], onDelete: Cascade)
}

model Plan {
  id                   String   @id @default(cuid())
  name                 String
  monthlyPrice         Decimal  @db.Decimal(10, 2)
  yearlyPrice          Decimal  @db.Decimal(10, 2)
  stripeMonthlyPriceId String?
  stripeYearlyPriceId  String?
  rowsLimit            Int      @default(50) // Maximum number of records/rows per search
  searchLimit          Int      @default(2)  // Maximum number of searches per month
  features             Json // Array of feature strings
  isPopular            Boolean  @default(false)
  displayOrder         Int      @default(0)
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt
  users                User[]
}

model Settings {
  id                    String   @id @default("settings")
  stripePublishableKey  String?
  stripeSecretKey       String?
  stripeWebhookSecret   String?
  updatedAt             DateTime @updatedAt
}
